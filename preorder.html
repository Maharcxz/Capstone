<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Ordering - Trinity Optimum Vision Center</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@300;400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="CSS/BaseStyles.css">
    <link rel="stylesheet" href="CSS/AboutUsPageStyles.css">
    <link rel="stylesheet" href="CSS/AdminPageStyles.css">
    <link rel="stylesheet" href="CSS/ConfirmationStyles.css">
    <link rel="stylesheet" href="CSS/ContactUsPageStyles.css">
    <link rel="stylesheet" href="CSS/FrameEditStyles.css">
    <link rel="stylesheet" href="CSS/FrameTypesMenuHeaderStyles.css">
    <link rel="stylesheet" href="CSS/HeaderStyles.css">
    <link rel="stylesheet" href="CSS/LogInModalStyles.css">
    <link rel="stylesheet" href="CSS/NotificationIconPanelStyles.css">
    <link rel="stylesheet" href="CSS/Pre-OrderStyles.css">
    <link rel="stylesheet" href="CSS/ProductGridStyles.css">
    <link rel="stylesheet" href="CSS/ResponsiveNotifStyles.css">
    <link rel="stylesheet" href="CSS/SidebarStyles.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <!-- Firebase Configuration (must be loaded first) -->
    <script src="JS/FirebaseConfig.js"></script>
    
    <!-- Application Scripts (loaded after Firebase is initialized) -->
    <script src="JS/AuthHandlers.js"></script>
    <script src="JS/ContentEditingFunc.js"></script>
    <script src="JS/EventListenerFunc.js"></script>
    <script src="JS/FrameCategoryFunc.js"></script>
    <script src="JS/FrameEditingModal.js"></script>
    <script src="JS/NotificationFunc.js"></script>
    <script src="JS/PassToggleFunc.js"></script>
    <script src="JS/Script.js"></script>
    <script src="JS/SeachFunc.js"></script>
    <script src="JS/SidebarFunc.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1 class="maintitle">T R I N I T Y</h1>
                <p class="subtitle">OPTIMUM VISION CENTER</p>
            </div>
            <nav class="nav">
                <div class="nav-left">
                    <a href="index.html" class="nav-link">
                        <span>Home</span>
                    </a>
                    <a href="contact.html" class="nav-link">
                        <span>Contact Us</span>
                    </a>
                    <a href="about.html" class="nav-link">
                        <span>About Us</span>
                    </a>

                    <a href="preorders.html" class="nav-link admin-only" id="preOrdersNav" style="display: none;">
                        <span>Pre-Orders</span>
                    </a>
                    <a href="admin-dashboard.html" class="nav-link admin-only" id="productManagementNav" style="display: none;">
                        <span>Product Management</span>
                    </a>
                </div>
                <div class="nav-right">
                    <div class="nav-icons">
                        <div class="notification-wrapper admin-only" style="display: none;">
                            <span class="notification-icon" onclick="toggleNotifications()">ðŸ””</span>
                            <span class="notification-badge" id="notificationBadge">0</span>
                        </div>
                    </div>
                    <div class="auth-section">
                        <a href="#" class="login-btn" id="authButton" onclick="handleAuthClick()">
                            <span class="user-icon">ðŸ‘¤</span>
                            <span id="authButtonText">Log In</span>
                        </a>
                        <div class="admin-dropdown" id="adminDropdown">
                            <button class="dropdown-item" onclick="navigateToPreorders()">
                                <span class="dropdown-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                                    </svg>
                                </span>
                                <span>Pre-Orders</span>
                            </button>

                            <button class="dropdown-item" onclick="toggleContentManagement()">
                                <span class="dropdown-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </span>
                                <span>Content Management</span>
                            </button>
                            <button class="dropdown-item" onclick="toggleUserManagement()">
                                <span class="dropdown-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 010 7.75"/>
                                    </svg>
                                </span>
                                <span>User Management</span>
                            </button>
                            <button class="dropdown-item" onclick="toggleAdminSettings()">
                                <span class="dropdown-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"/>
                                        <path d="M4.93 4.93l1.41 1.41M4.93 19.07l1.41-1.41M19.07 4.93l-1.41 1.41M19.07 19.07l-1.41-1.41M12 2v2M12 20v2M2 12h2M20 12h2"/>
                                    </svg>
                                </span>
                                <span>Admin Settings</span>
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <!-- Login Modal -->
        <div class="login-modal-overlay" id="loginModalOverlay" onclick="hideLoginModal()">
            <div class="login-modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h2 class="modal-title">W E L C O M E</h2>
                </div>
                
                <form class="login-form" id="modalLoginForm">
                    <div class="input-group">
                        <span class="input-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                        </span>
                        <input type="email" placeholder="Email Address" class="login-input" id="modalEmailInput" required>
                    </div>
                    
                    <div class="input-group">
                        <span class="input-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <circle cx="12" cy="16" r="1"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                        </span>
                        <input type="password" placeholder="Password" class="login-input" id="modalPasswordInput" required>
                        <span class="password-toggle" onclick="togglePassword()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </span>
                    </div>
                    
                    <div class="remember-me-group">
                        <label class="remember-me-label">
                            <input type="checkbox" id="rememberMeCheckbox" class="remember-me-checkbox">
                            <span class="checkmark"></span>
                            Remember me
                        </label>
                    </div>
                    
                    <button type="submit" class="modal-login-btn">Log In</button>
                    
                    <div class="guest-option">
                        <span class="continue-text">Or continue as</span>
                        <button type="button" class="guest-btn" onclick="hideLoginModal()">Guest</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Pre-Order Content -->
        <main class="preorder-content">
            <h2 class="preorder-page-title">PRE-ORDERING</h2>
            
            <div class="preorder-form-container">
                <form class="preorder-page-form" id="preorderForm">
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-field">
                                <label class="field-label">Full Name</label>
                                <div class="name-inputs">
                                    <input type="text" placeholder="First Name" class="name-input" name="firstName" id="firstName" required>
                                    <input type="text" placeholder="Last Name" class="name-input" name="lastName" id="lastName" required>
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label class="field-label">Email</label>
                                <input type="email" placeholder="email@example.com" class="full-input" name="email" id="email" required>
                            </div>
                            
                            <div class="form-field">
                                <label class="field-label">Phone Number</label>
                                <input type="tel" placeholder="+63" class="full-input" name="phone" id="phone" required>
                            </div>
                            
                            <div class="form-field">
                                <label class="field-label">Frame Name</label>
                                <input type="text" placeholder="Frame Name or Model" class="full-input" name="frameName" id="frameName">
                            </div>
                            
                            <div class="form-field">
                                <label class="field-label">Quantity</label>
                                <select class="quantity-select" name="quantity" id="quantity" required>
                                    <option value="">Select Quantity</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10+</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-column">
                            <div class="form-field">
                                <label class="field-label">Prescription (Optional)</label>
                                <textarea placeholder="Enter prescription details if available..." class="note-textarea" name="prescription" id="prescription"></textarea>
                            </div>
                            
                            <div class="form-field">
                                <label class="field-label">Additional Notes</label>
                                <textarea placeholder="Add your note here..." class="note-textarea" name="notes" id="notes"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="submit-btn">Submit</button>
                        <button type="button" class="cancel-btn" onclick="window.history.back()">Cancel</button>
                    </div>
                    
                    <div id="formMessage" class="form-message"></div>
                </form>
            </div>
        </main>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const preorderForm = document.getElementById('preorderForm');
            
            if (preorderForm) {
                preorderForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const firstName = document.getElementById('firstName').value;
                    const lastName = document.getElementById('lastName').value;
                    const email = document.getElementById('email').value;
                    const phone = document.getElementById('phone').value;
                    const frameName = document.getElementById('frameName').value;
                    const quantity = document.getElementById('quantity').value;
                    const prescription = document.getElementById('prescription').value;
                    const notes = document.getElementById('notes').value;
                    
                    // Create pre-order object
                    const preOrder = {
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        phone: phone,
                        frameName: frameName,
                        quantity: quantity,
                        prescription: prescription,
                        notes: notes,
                        date: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    // Save to Firebase
                    savePreOrderToFirebase(preOrder);
                });
            }
        });
        
        // Function to save pre-order to Firebase
        function savePreOrderToFirebase(preOrder) {
            const preOrdersRef = firebase.database().ref('preOrders');
            const formMessage = document.getElementById('formMessage');
            
            // Show loading message
            formMessage.textContent = 'Submitting your pre-order...';
            formMessage.className = 'form-message info';
            
            // Push data to Firebase
            preOrdersRef.push(preOrder)
                .then((result) => {
                    console.log('Pre-order saved successfully with ID:', result.key);
                    
                    // Show success message
                    formMessage.textContent = 'Pre-order submitted successfully!';
                    formMessage.className = 'form-message success';
                    
                    // Reset form
                    document.getElementById('preorderForm').reset();
                    
                    // Redirect to confirmation page after a short delay
                    setTimeout(() => {
                        window.location.href = `preorder-confirmation.html?frameName=${encodeURIComponent(preOrder.frameName)}`;
                    }, 500);
                })
                .catch((error) => {
                    console.error('Error saving pre-order:', error);
                    
                    // Show error message
                    formMessage.textContent = 'Error submitting pre-order. Please try again.';
                    formMessage.className = 'form-message error';
                });
        }
    </script>
</html>