<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Categories</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        input { padding: 8px; margin: 5px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        #existingCategories { border: 1px solid #ccc; padding: 10px; margin: 10px 0; min-height: 100px; }
        .category-item { padding: 5px; margin: 5px 0; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Category Test</h1>
    
    <div class="form-group">
        <label for="categoryName">Category Name:</label>
        <input type="text" id="categoryName" placeholder="Enter category name">
        <button onclick="addCategoryFromForm()">Add Category</button>
    </div>
    
    <div>
        <h3>Existing Categories</h3>
        <div id="existingCategories">No categories created yet</div>
    </div>
    
    <div>
        <button onclick="clearCategories()">Clear All Categories</button>
        <button onclick="showLocalStorage()">Show localStorage</button>
    </div>

    <script>
        // Simplified version of the category functionality
        let sidebarCategories = [];

        function loadSidebarCategories() {
            const saved = localStorage.getItem('sidebarCategories');
            sidebarCategories = saved ? JSON.parse(saved) : [];
            console.log('Loaded categories:', sidebarCategories);
            renderExistingCategories();
        }

        function saveSidebarCategories() {
            localStorage.setItem('sidebarCategories', JSON.stringify(sidebarCategories));
            console.log('Saved categories to localStorage');
        }

        function generateCategoryId(name) {
            return name.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
        }

        function addCategoryFromForm() {
            console.log('addCategoryFromForm called');
            const categoryNameInput = document.getElementById('categoryName');
            const categoryName = categoryNameInput.value.trim();
            console.log('Category name from input:', categoryName);
            
            if (!categoryName) {
                alert('Please enter a category name');
                return;
            }
            
            // Check if category already exists
            const exists = sidebarCategories.some(cat => 
                cat.name.toLowerCase() === categoryName.toLowerCase()
            );
            
            if (exists) {
                alert('Category already exists');
                return;
            }
            
            // Add new category
            const newCategory = {
                id: generateCategoryId(categoryName),
                name: categoryName,
                icon: 'üè∑Ô∏è',
                createdAt: new Date().toISOString()
            };
            
            sidebarCategories.push(newCategory);
            console.log('Categories after push:', sidebarCategories);
            saveSidebarCategories();
            renderExistingCategories();
            
            // Clear input
            categoryNameInput.value = '';
            
            alert(`Category "${categoryName}" added successfully!`);
        }

        function renderExistingCategories() {
            console.log('renderExistingCategories called with:', sidebarCategories);
            const container = document.getElementById('existingCategories');
            console.log('Container element:', container);
            
            if (sidebarCategories.length === 0) {
                console.log('No categories, showing empty message');
                container.innerHTML = '<em>No categories created yet</em>';
                return;
            }
            
            const categoriesHtml = sidebarCategories.map(category => `
                <div class="category-item">
                    ${category.icon} ${category.name}
                    <button onclick="deleteCategory('${category.id}')" style="float: right; background: #dc3545;">Delete</button>
                </div>
            `).join('');
            
            container.innerHTML = categoriesHtml;
        }

        function deleteCategory(categoryId) {
            sidebarCategories = sidebarCategories.filter(cat => cat.id !== categoryId);
            saveSidebarCategories();
            renderExistingCategories();
            alert('Category deleted');
        }

        function clearCategories() {
            sidebarCategories = [];
            saveSidebarCategories();
            renderExistingCategories();
            alert('All categories cleared');
        }

        function showLocalStorage() {
            const saved = localStorage.getItem('sidebarCategories');
            console.log('localStorage content:', saved);
            alert('Check console for localStorage content');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            loadSidebarCategories();
        });
    </script>
</body>
</html>