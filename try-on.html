<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Virtual Try-On - Trinity Optimum Vision Center</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@300;400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="CSS Styles/BaseStyles.css">
    <link rel="stylesheet" href="CSS Styles/AboutUsPageStyles.css">
    <link rel="stylesheet" href="CSS Styles/AdminPageStyles.css">
    <link rel="stylesheet" href="CSS Styles/ConfirmationStyles.css">
    <link rel="stylesheet" href="CSS Styles/ContactUsPageStyles.css">
    <link rel="stylesheet" href="CSS Styles/FrameEditStyles.css">
    <link rel="stylesheet" href="CSS Styles/FrameTypesMenuHeaderStyles.css">
    <link rel="stylesheet" href="CSS Styles/HeaderStyles.css">
    <link rel="stylesheet" href="CSS Styles/LogInModalStyles.css">
    <link rel="stylesheet" href="CSS Styles/NotificationIconPanelStyles.css">
    <link rel="stylesheet" href="CSS Styles/Pre-OrderStyles.css">
    <link rel="stylesheet" href="CSS Styles/ProductGridStyles.css">
    <link rel="stylesheet" href="CSS Styles/ResponsiveNotifStyles.css">
    <link rel="stylesheet" href="CSS Styles/SidebarStyles.css">
    <link rel="stylesheet" href="CSS Styles/HeaderStyles.css">
    <link rel="stylesheet" href="CSS Styles/TryOnStyles.css">
    
    <!-- A-Frame and MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-aframe.prod.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
	const list = ["glasses1", "glasses2"];
	const visibles = [true, false];
	const setVisible = (button, entities, visible) => {
	  if (button) {
	    if (visible) {
	      button.classList.add("selected");
	    } else {
	      button.classList.remove("selected");
	    }
	  }
	  entities.forEach((entity) => {
	    if (entity) {
	      entity.setAttribute("visible", visible);
	    }
	  });
	}
	list.forEach((item, index) => {
	  const button = document.querySelector("#" + item);
	  const entities = document.querySelectorAll("." + item + "-entity");
	  if (button && entities.length > 0) {
	    setVisible(button, entities, visibles[index]);
	    button.addEventListener('click', () => {
	      visibles[index] = !visibles[index];
	      setVisible(button, entities, visibles[index]);
	    });
	  }
	});
      })
    </script>
</head>
<body>
    <div class="virtual-try-on-container">
        <header class="try-on-header" id="tryOnHeader">
              <h1 class="try-on-title" id="tryOnTitle">Virtual Try-On</h1>
              <a href="index.html" class="back-button-header">â†© Back to Products</a>
          </header>
        
        <main class="try-on-main">
            <div class="camera-container">
                <!-- Loading overlay -->
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="loading-spinner"></div>
                    <p>Initializing AR Camera...</p>
                </div>
                
                <a-scene mindar-face embedded color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" style="height: 100vh; width: 100vw;">
                     <a-assets>
                         <a-asset-item id="glassesModel1" src="SampleDropdownAssets/3dglasses.glb"></a-asset-item>
                         <a-asset-item id="glassesModel2" src="SampleDropdownAssets/glasses1.glb"></a-asset-item>
                         <a-asset-item id="headOccluder" src="Assets/headOccluder.glb"></a-asset-item>
                     </a-assets>
                     
                     <a-camera 
                         id="camera"
                         position="0 0 0" 
                         look-controls="enabled: false" 
                         wasd-controls="enabled: false"
                         cursor="rayOrigin: mouse">
                     </a-camera>
                     
                     <!-- Head occluder for better AR effect -->
                     <a-entity mindar-face-target="anchorIndex: 168">
                         <a-gltf-model 
                             mindar-face-occluder 
                             position="0 -0.3 0.15"
                             rotation="0 0 0" 
                             scale="0.065 0.065 0.065" 
                             src="#headOccluder">
                         </a-gltf-model>
                     </a-entity>
                     
                     <!-- Glasses Model 1 - 3D Glasses -->
                     <a-entity mindar-face-target="anchorIndex: 168">
                         <a-gltf-model 
                             rotation="0 0 0" 
                             position="0 0 0" 
                             scale="0.010 0.010 0.010" 
                             src="#glassesModel1" 
                             class="glasses1-entity" 
                             visible="true">
                         </a-gltf-model>
                     </a-entity>
                     
                     <!-- Glasses Model 2 - Glasses1 -->
                     <a-entity mindar-face-target="anchorIndex: 168">
                         <a-gltf-model 
                             rotation="0 0 0" 
                             position="0 0 0" 
                             scale="0.010 0.010 0.010" 
                             src="#glassesModel2" 
                             class="glasses2-entity" 
                             visible="false">
                         </a-gltf-model>
                     </a-entity>
                 </a-scene>
                 
                 <!-- Controls Panel Removed -->
         </div>
         </main>
         
         <!-- Status message -->
         <div class="status-message" id="statusMessage"></div>
     </div>
     
     <script>
         // Navigation function
         function navigateToHome() {
             window.location.href = 'index.html';
         }
         
         // Add red background when header is clicked (UI feedback)
         (function() {
            const header = document.getElementById('tryOnHeader');
            if (header) {
              header.addEventListener('click', function(e) {
                // Ignore clicks on the back button link to avoid delayed navigation
                if (e.target.closest('.back-button-header')) return;
                header.classList.add('clicked');
                // Brief red flash, then navigate home
                setTimeout(() => {
                  header.classList.remove('clicked');
                  navigateToHome();
                }, 150);
              });
            }
         })();
         
         // Glasses selection functions
         function selectGlasses(model, name) {
             // Update selected glasses display
             document.getElementById('selected-glasses').textContent = name;
             
             // Update selected state
             document.querySelectorAll('.dropdown-item').forEach(item => {
                 item.classList.remove('selected');
             });
             document.querySelector(`[data-model="${model}"]`).classList.add('selected');
             
             // Hide/show glasses models
             const glasses1Entity = document.querySelector('.glasses1-entity');
             const glasses2Entity = document.querySelector('.glasses2-entity');
             
             if (model === 'glasses1') {
                 if (glasses1Entity) glasses1Entity.setAttribute('visible', true);
                 if (glasses2Entity) glasses2Entity.setAttribute('visible', false);
             } else if (model === 'glasses2') {
                 if (glasses1Entity) glasses1Entity.setAttribute('visible', false);
                 if (glasses2Entity) glasses2Entity.setAttribute('visible', true);
             }
             
             // Close dropdown
             document.getElementById('glassesDropdown').classList.remove('show');
         }
         
         // Toggle dropdown function
         function toggleDropdown() {
             const dropdown = document.getElementById('glassesDropdown');
             dropdown.classList.toggle('show');
         }
         
         // Close dropdown when clicking outside
         window.onclick = function(event) {
             if (!event.target.matches('.dropdown-btn') && !event.target.matches('.dropdown-arrow')) {
                 const dropdown = document.getElementById('glassesDropdown');
                 if (dropdown.classList.contains('show')) {
                     dropdown.classList.remove('show');
                 }
             }
         }
         
         // Capture photo function
         function capturePhoto() {
             // Implementation for photo capture
             console.log('Capturing photo...');
         }
         
         // Switch camera function
         function switchCamera() {
             // Implementation for camera switching
             console.log('Switching camera...');
         }
         
         // Status message function
         function showStatus(message, type = 'info') {
             const statusElement = document.getElementById('statusMessage');
             statusElement.textContent = message;
             statusElement.className = `status-message ${type}`;
             statusElement.style.display = 'block';
             
             setTimeout(() => {
                 statusElement.style.display = 'none';
             }, 3000);
         }
         
         // Hide loading overlay when AR is ready
         document.addEventListener('DOMContentLoaded', function() {
             const loadingOverlay = document.getElementById('loadingOverlay');
             
             // Simulate AR initialization
             setTimeout(() => {
                 loadingOverlay.style.display = 'none';
             }, 2000);
         });
     </script>
     <!-- Firebase SDK (compat) -->
     <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
     <script src="Javascript Styles/FirebaseConfig.js"></script>
     <script src="Javascript Styles/AuthHandlers.js"></script>
     <script src="Javascript Styles/ContentEditingFunc.js"></script>
     <script src="Javascript Styles/EventListenerFunc.js"></script>
     <script src="Javascript Styles/FrameCategoryFunc.js"></script>
     <script src="Javascript Styles/FrameEditingModal.js"></script>
     <script src="Javascript Styles/NotificationFunc.js"></script>
     <script src="Javascript Styles/PassToggleFunc.js"></script>
     <script src="Javascript Styles/Script.js"></script>
     <script src="Javascript Styles/SeachFunc.js"></script>
     <script src="Javascript Styles/SidebarFunc.js"></script>
     <!-- Set try-on header title based on productName from URL -->
      <script>
      document.addEventListener('DOMContentLoaded', function() {
      const params = new URLSearchParams(window.location.search);
      const productName = params.get('productName');
      if (productName) {
      const headerTitle = document.querySelector('.try-on-title');
      if (headerTitle) headerTitle.textContent = productName;
      }
      });
      </script>
 </body>
 </html>